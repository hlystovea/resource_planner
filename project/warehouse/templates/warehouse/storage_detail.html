{% load static %}
<h4>Запасные части</h4>
<table class="table table-sm table-hover">
  <thead class="table">
    <tr>
      <th scope="col">Производитель</th>
      <th scope="col">Наименование</th>
      <th scope="col">Тип</th>
      <th scope="col">Инв. номер</th>
      <th scope="col">Количество</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    {% for c in storage.components.all %}
      <tr>
        <td>{{ c.component.manufacturer|default:"-" }}</td>
        <td><a href="{% url 'hardware:component-detail' c.component.pk %}">{{ c.component.name }}</a></td>
        <td>{{ c.component.type|default:"-" }}</td>
        <td>{{ c.inventory_number|default:"-" }}</td>
        <td>{{ c.amount }} шт.</td>
        <td>
          {% if user.is_authenticated and user.is_superuser or user.is_authenticated and user.dept == c.owner %}
            <a class="btn btn-sm btn-secondary me-1 my-0" href="{% url 'warehouse:component-storage-update' c.storage.pk c.pk %}" role="button">
              <img src="{% static 'icons/pen.svg' %}" height="16" fill="currentColor" class="bi bi-pen">
            </a>
            <button type="button" class="btn btn-sm btn-danger my-0" data-bs-toggle="modal" data-bs-target="#deleteComponentModal_{{ c.pk }}">
              <img src="{% static 'icons/basket.svg' %}" height="16" fill="currentColor" class="bi bi-basket">
            </button>
            {% include 'warehouse/componentstorage_confirm_delete.html' %}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    {% if user.is_authenticated %}
      <tr>
        <form method="post" enctype="multipart/form-data" action="{% url 'warehouse:component-storage-create' storage.pk %}">
          {% csrf_token %}
          {% load user_filters %}
          <td colspan="3">{{ component_add_form.component|addclass:"form-control form-control-sm" }}</td>
          <td>{{ component_add_form.inventory_number|addclass:"form-control form-control-sm" }}</td>
          <td>{{ component_add_form.amount|addclass:"form-control form-control-sm" }}</td>
          <td><button type="submit" class="btn btn-sm btn-secondary me-1">Добавить</button></td>
        </form>
      </tr>
    {% endif %}
  </tbody>
</table>
<br>
<br>
<h4>Расходные материалы</h4>
<table class="table table-sm table-hover">
  <thead class="table">
    <tr>
      <th scope="col">Наименование</th>
      <th scope="col">Артикул</th>
      <th scope="col">Инв. номер</th>
      <th scope="col">Количество</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    {% for m in storage.materials.all %}
      <tr>
        <td><a href="{% url 'warehouse:material-detail' m.material.pk %}">{{ m.material.name }}</a></td>
        <td>{{ m.material.article_number|default:"-" }}</td>
        <td>{{ m.inventory_number|default:"-" }}</td>
        <td>{{ m.amount|floatformat }} {{ m.material.measurement_unit}}</td>
        <td>
          {% if user.is_authenticated and user.is_superuser or user.is_authenticated and user.dept == m.owner %}
            <a class="btn btn-sm btn-secondary me-1 my-0" href="{% url 'warehouse:material-storage-update' m.storage.pk m.pk %}" role="button">
              <img src="{% static 'icons/pen.svg' %}" height="16" fill="currentColor" class="bi bi-pen">
            </a>
            <button type="button" class="btn btn-sm btn-danger my-0" data-bs-toggle="modal" data-bs-target="#deleteMaterialModal_{{ m.pk }}">
              <img src="{% static 'icons/basket.svg' %}" height="16" fill="currentColor" class="bi bi-basket">
            </button>
            {% include 'warehouse/materialstorage_confirm_delete.html' %}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    {% if user.is_authenticated %}
      <tr>
        <form method="post" enctype="multipart/form-data" action="{% url 'warehouse:material-storage-create' storage.pk %}">
          {% csrf_token %}
          {% load user_filters %}
          <td>{{ material_add_form.material|addclass:"form-control form-control-sm" }}</td>
          <td></td>
          <td>{{ material_add_form.inventory_number|addclass:"form-control form-control-sm" }}</td>
          <td>{{ material_add_form.amount|addclass:"form-control form-control-sm" }}</td>
          <td><button type="submit" class="btn btn-sm btn-secondary me-1">Добавить</button></td>
        </form>
      </tr>
    {% endif %}
  </tbody>
</table>
